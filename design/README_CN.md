# 设计层 - 元建模系统

**设计层**是配置引擎，业务领域在此无需编程即可定义。该层提供元建模基础设施，实现无代码业务实体创建和复杂工作流设计。

## 核心目的

设计层作为蓝图定义系统，可以：
- 通过元模型定义业务实体，无需编码
- 声明式配置服务流程和工作流
- 管理资源类型和需求
- 从数据结构动态生成表单和UI
- 通过继承和组合实现运行时模型生成

## 关键组件

### 数据结构设计器

**DataItem** - 定义业务实体的核心元模型：
- **字段类型系统**：支持Django字段类型（CharField、IntegerField等）
- **业务类型继承**：通过`business_type`实现实体继承层次
- **组合关系**：通过`DataItemConsists`实现复杂结构
- **实现类型**：Field、Model、Log、Dict用于不同实体角色
- **计算逻辑**：动态字段计算和业务规则

**DataItemConsists** - 数据项之间的组合关系：
- **顺序管理**：组合元素的排序
- **API映射**：与外部系统集成
- **默认值**：预配置字段默认值

### 服务架构设计器

**Service** - 可配置的业务流程和工作流：
- **通用内容类型**：服务可以操作任何实体类型
- **服务组合**：通过ServiceConsists实现复杂工作流
- **资源需求**：多维度资源分配
- **表单集成**：从服务定义动态生成UI
- **API集成**：外部系统连接

**ServiceRule** - 事件驱动的业务逻辑定义：
- **事件触发器**：自动化工作流激活
- **系统指令**：编排的系统操作
- **实体绑定**：与任何业务对象的通用关系
- **参数传递**：可配置规则参数

**Event** - 触发条件和自动化表达式：
- **表达式评估**：动态条件检查
- **定时器事件**：计划的自动化触发器
- **参数配置**：事件特定数据传递

### 资源规划设计器

**资源类型** - 抽象资源定义：
- **Material** - 物理用品和库存
- **Equipment** - 共享医疗设备
- **Device** - 工具和仪器
- **Capital** - 财务资源抽象
- **Knowledge** - 信息和专业知识

**资源需求** - 服务到资源映射：
- **数量规格**：所需资源数量
- **多资源服务**：复杂资源依赖关系
- **容量规划**：资源分配算法

### 人力资源

**Operator** - 人员和角色定义：
- **基于角色的访问**：通过角色的服务权限
- **上下文管理**：操作员特定数据和状态
- **组织结构**：分层人员管理

**Role** - 权限和服务分组：
- **服务授权**：对业务流程的受控访问
- **多角色支持**：灵活的权限组合

### UI/表单生成器

**Form** - 从数据结构的动态表单定义：
- **字段展开**：从DataItems自动生成表单
- **选择类型**：各种输入控件类型
- **聚合字段**：复杂数据展示
- **可见性控制**：条件字段显示

**MenuItem** - 导航结构生成：
- **分层菜单**：树状结构导航
- **表单集成**：直接链接到生成的表单
- **图标支持**：视觉菜单增强

### 外部集成

**Api** - 外部系统集成定义：
- **RESTful支持**：多种HTTP方法
- **字段映射**：系统间数据转换
- **文档**：API规范管理

**Project** - 领域部署配置：
- **源代码管理**：生成代码跟踪
- **领域规格**：业务区域定义

## 元编程架构

### 运行时模型生成
设计层实现真正的元编程：
1. **DataItem定义**指定实体结构
2. **动态类生成**在运行时创建Django模型
3. **中文语言支持**自动拼音转换
4. **继承和组合**支持复杂业务关系

### 无代码配置
业务分析师可以：
- 定义实体无需编程知识
- 通过可视化工具配置工作流
- 声明式管理资源需求
- 从数据定义自动生成表单

### 架构演进
系统支持：
- **动态字段添加**无需迁移
- **业务逻辑修改**通过配置
- **工作流适应**无需代码更改
- **多租户定制**每个领域

## 与其他层的集成

### 内核层集成
- **流程绑定**连接实体到工作流引擎
- **服务执行**从设计定义触发
- **资源分配**基于设计规格
- **事件处理**驱动自动化工作流

### 应用层生成
- **模型实例化**从DataItem定义
- **业务逻辑继承**从设计模式
- **流程集成**通过内核连接
- **API生成**用于前端消费

## 文件结构

- `models.py` - 核心元模型定义
- `types.py` - 类型定义和选择
- `utils.py` - 元编程工具
- `admin.py` - Django管理配置
- `views.py` - 设计管理的API端点

## 使用模式

### 实体定义
1. 创建带字段规格的DataItem
2. 通过business_type配置继承
3. 通过DataItemConsists添加组合
4. 通过工具生成运行时模型

### 服务配置
1. 定义带内容类型目标的Service
2. 添加资源需求
3. 配置自动化的ServiceRules
4. 链接到表单进行UI生成

### 工作流设计
1. 创建事件触发器
2. 定义系统指令
3. 配置链接事件到动作的ServiceRules
4. 通过内核执行测试自动化

设计层代表ERP框架最具创新性的方面 - 使业务领域专家能够配置复杂的企业系统，无需传统的开发周期。