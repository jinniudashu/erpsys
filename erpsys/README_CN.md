# ERP系统核心配置

**erpsys/** 目录包含协调三层元框架架构的核心Django项目配置。该目录作为整个ERP系统的中央协调点。

## 目的

该核心配置模块：
- **集成所有框架层** - 设计层、内核层和应用层
- **配置Django设置** 用于开发和生产环境
- **管理实时通信** 通过Django Channels和WebSockets
- **协调异步任务处理** 通过Celery集成
- **提供集中路由** 用于所有框架组件

## 关键文件

### settings.py - 环境配置

**多环境支持**：
- **开发环境**：SQLite数据库配合本地Redis
- **生产环境**：PostgreSQL配合容器化Redis
- **环境变量**：通过django-environ灵活配置

**技术栈集成**：
- **Django Channels** - WebSocket支持实时更新
- **Celery配置** - 使用Redis代理的异步任务处理
- **CORS设置** - 与Vue.js/HTMX的前端集成
- **JWT认证** - 基于令牌的API安全
- **静态文件** - WhiteNoise用于生产环境静态文件服务

**中文语言支持**：
- **语言区域**：zh-hans（简体中文）
- **时区**：Asia/Shanghai
- **字符编码**：完整Unicode支持中文文本

### urls.py - 路由配置

**应用集成**：
- **自定义管理站点** - `applications_site`用于业务领域管理
- **标准管理** - Django管理用于系统管理
- **模块化路由** - 应用关注点的清晰分离

**客户站点映射**：
- 基于`CUSTOMER_SITE_NAME`设置的动态URL前缀
- 支持不同URL命名空间的多租户部署

### asgi.py - 实时通信

**协议路由**：
- **HTTP协议** - 标准Django ASGI应用
- **WebSocket协议** - 通过Django Channels的实时更新
- **认证中间件** - 安全的WebSocket连接

**实时功能**：
- **流程状态更新** - 实时流程状态变化
- **资源可用性** - 实时资源状态更新
- **操作员通知** - 即时任务分配和更新

### celery.py - 异步任务配置

**任务处理**：
- **后台作业** - 长时间运行的业务流程执行
- **计划任务** - 自动化工作流触发器和维护
- **资源管理** - 异步资源分配和清理

**框架集成**：
- **流程执行** - 业务流程的异步执行
- **事件处理** - 后台事件评估和触发器
- **系统维护** - 自动化清理和优化任务

### wsgi.py - 生产部署

**WSGI应用**：
- 用于生产部署的标准Django WSGI配置
- 与Gunicorn和其他WSGI服务器兼容
- 生产就绪的应用服务

## 框架集成

### 层协调

**设计层集成**：
- **服务配置** - 路由到设计层进行服务定义
- **元模型访问** - DataItem和Form配置管理
- **API生成** - 从设计规格动态创建API

**内核层集成**：
- **流程管理** - 实时流程状态同步
- **资源调度** - 资源分配的协调
- **事件处理** - 实时事件触发器和自动化

**应用层集成**：
- **领域模型** - 访问生成的业务实体模型
- **自定义管理** - 业务特定的管理界面
- **API端点** - 对业务数据的RESTful访问

### 多租户架构

**客户站点配置**：
- **动态路由** - 客户特定的URL命名空间
- **环境配置** - 每个客户的设置和品牌
- **数据隔离** - 安全的多租户数据分离

### 实时能力

**WebSocket集成**：
- **流程更新** - 实时工作流状态变化
- **操作员仪表板** - 实时任务列表和通知
- **资源监控** - 实时资源可用性和利用率

**异步处理**：
- **后台工作流** - 长时间运行的业务流程
- **计划自动化** - 基于定时器的流程触发器
- **资源优化** - 后台资源管理

## 开发环境 vs 生产环境

### 开发配置
```python
if DJANGO_ENV == 'dev':
    DEBUG = True
    DATABASES = {'default': {'ENGINE': 'django.db.backends.sqlite3'}}
    REDIS_HOST = 'localhost:6379'
```

### 生产配置
```python
else:
    DEBUG = False
    DATABASES = {'default': {'ENGINE': 'django.db.backends.postgresql'}}
    REDIS_HOST = 'redis:6379'  # Docker容器
```

## 安全功能

**认证和授权**：
- **JWT令牌** - 具有可配置过期时间的安全API访问
- **CORS配置** - 受控的前端访问
- **CSRF保护** - 标准Django CSRF安全

**环境安全**：
- **密钥管理** - 基于环境的密钥配置
- **数据库安全** - 参数化数据库连接
- **API安全** - 所有API端点基于令牌的认证

## 部署架构

**Docker支持**：
- **多服务配置** - Django、PostgreSQL、Redis、Celery
- **环境隔离** - 基于容器的部署
- **可扩展性** - 通过负载均衡支持水平扩展

**生产就绪**：
- **静态文件服务** - WhiteNoise用于高效静态文件传递
- **数据库优化** - PostgreSQL配合连接池
- **缓存策略** - Redis用于会话和应用缓存

## 监控和日志

**应用日志**：
- **结构化日志** - 用于分析的JSON格式日志
- **文件和控制台** - 开发和生产的双重输出
- **错误跟踪** - 全面的错误日志和报告

**性能监控**：
- **数据库查询优化** - Django查询分析
- **缓存命中率** - Redis性能监控
- **流程性能** - 工作流执行时间

erpsys配置代表了使复杂三层元框架作为一个内聚、可扩展的企业系统运行的编排层。